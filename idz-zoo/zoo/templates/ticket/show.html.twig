{% extends 'base.html.twig' %}

{% block title %}Ticket{% endblock %}

{% block javascripts %}
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js" defer></script>
{% endblock %}

{% block body %}
<div class="table-container">
    <h2>Ticket</h2>
    <div class="table-con">
        <table class="table">
            <tbody>
                <tr>
                    <th>Id</th>
                    <td>{{ ticket.id }}</td>
                </tr>
                <tr>
                    <th>TicketDate</th>
                    <td>{{ ticket.ticketDate }}</td>
                </tr>
                <tr>
                    <th>TicketTime</th>
                    <td>{{ ticket.ticketTime }}</td>
                </tr>
                <tr>
                    <th>TicketCost</th>
                    <td>{{ ticket.ticketCost }}</td>
                </tr>
                <tr>
                    <th>UserEmail</th>
                    <td>{{ ticket.userEmail }}</td>
                </tr>
            </tbody>
        </table>
    </div>
    <div class="form-group">
        <a href="{{ path('app_ticket_index') }}">back to list</a>
    </div>
        <a href="{{ path('app_ticket_edit', {'id': ticket.id}) }}">edit</a>
    </div>
</div>
    {{ include('ticket/_delete_form.html.twig') }}
{% endblock %}

<script>
document.addEventListener("DOMContentLoaded", function () {
    document.querySelectorAll(".qr-code").forEach(function (el) {
        new QRCode(el, {
            text: el.dataset.text,
            width: 80,
            height: 80,
        });
    });

    document.querySelectorAll('.cancel-btn').forEach(button => {
        const dateStr = button.dataset.date;
        const timeStr = button.dataset.time;
        const ticketDateTime = new Date(`${dateStr}T${timeStr}`);
        const now = new Date();

        if (ticketDateTime < now) {
            button.textContent = 'Просрочен';
            button.disabled = true;
        }
    });

    document.querySelectorAll('.cancel-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            const ticketId = this.dataset.ticketId;
            if (confirm('Вы уверены, что хотите отменить билет?')) {
            const form = document.createElement('form');
            form.method = 'POST';
            form.action = '/tickets/cancel';

            const input = document.createElement('input');
            input.type = 'hidden';
            input.name = 'ticket_id';
            input.value = this.dataset.ticketId;
            form.appendChild(input);

            document.body.appendChild(form);
            form.submit();
            }
        });
    });
});
</script>
